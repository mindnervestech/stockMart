@(localUser: User)

<script src="@routes.Assets.at("javascripts/MarkitQuoteServiceSample.js")" type="text/javascript"></script>

<div id="content" class="clearfix">

		<div class="header">
			
			<h1 class="page-title">Dashboard</h1>

		</div>

	<div class="wrp clearfix">
	
		<!-- DropDown Responsive -->
			<select id="qn">
				<option>Add an Article</option>
				<option>Save File</option>
				<option>Add More</option>
				<option>Messages</option>
				<option selected>Check Statistics</option>
			</select>
			<!-- /DropDown Responsive -->
			
			<div class="quick-nav">
				<ul style="width:100%">
					<li class="qn-last pull-right"><a style="padding-left:0%;padding-right:0%;"><input type="text" style="line-height:40px;" id="symbolsearch1" placeholder="Get Quotes"></a></li>
				</ul>
			</div>
			
	
	
		<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
			<div class="fluid" style="width:100%;">
				<div class="widget grid6">
					<div class="widget-header">
						<div class="widget-title">
							<i class="fa fa-comments"></i> Online
						</div>
					</div> <!-- /widget-header -->
	             	
	             	<div class=" widget-content" style="width:100%;height:56%;">
						<div class="thumbnail" style="height:100%;">
								
						</div>
					</div>	
				</div> <!-- /widget -->
			</div>
		</div>
		
		<div class="col-xs-9 col-sm-9 col-md-9 col-lg-9">
		<!-- Chat Section -->
		
			<div class="fluid" ng-init="loadAllChats(@localUser.id)">
				<div class="widget grid6">
					<div class="widget-header">
						<div class="widget-title">
							<i class="fa fa-comments"></i> Chats
						</div>
					</div> <!-- /widget-header -->
						                                   
	 	             <div class=" widget-content" style="width:100%;height:56%;">
						<div class="thumbnail" style="width:100%;height:58%;" id="messages">
            		 	</div>
            		 
		             	<div style="float:left;width:100%;">
			             	<textarea id="talk" rows="4" cols="70"></textarea>
			             	<div style="margin-top:5%;">
			             		<input style="padding-left: 0%; height: inherit; width: 50%; float: left;" type="file" class="image" id="image">
			             		<button id="send" style="float:right;" class="btn btn-blue">Send</button>
		             		</div>
		             	</div>
		             </div> 
	             
	             
				</div> <!-- /widget -->
			</div>
	 	
	<!-- Wish-list Section -->

			<div class="fluid" ng-init="loadAllWishlist()">
				<div class="widget grid6" style="height:64%;">
					<div class="widget-header">
						<div class="widget-title" style="width:100%;">
							<i class="fa fa-comments"></i> WishList
							<div class="widget-content" style="float:right;width:50%;margin-right:4.8%;padding:2px;">
							<i style="float:right;padding-top:3%;margin-left:5%;" class="fa fa-refresh" ng-click="refreshAll()"></i>
							<input type="text" style="float:right;width:80%;" ng-model="text" id="symbolsearch" placeholder="Enter symbol">
							</div>
						</div>
					</div> <!-- /widget-header -->
										
						                                   
		             <div class="widget-content" style="width:100%;height:62%;">
		             						        	
							<div class="thumbnail" style="height:154%;">
							<div id="resultContainer" data-ng-repeat="result in results">
								
								<div class="up" ng-show="result.Change > 0" style="float:left;width:100%;">
									<div  class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="float:left;">
										<img style="height:25px;" src="/assets/images/up.jpg">
									</div>
									<div data-ng-click="showQuote($index)" class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="float:left;">
										<p id="name" style="width: 100%;font-size: 10px;float: left;margin-bottom: 0px;">{{result.Name}}</p>
										<p id="prize" style="font-size: 10px; font-weight: bolder;">${{result.LastPrice}}</p>
									</div>
									<div class="col-xs-7 col-sm-7 col-md-7 col-lg-7"style="float:right;">
										<div class="row" style="float:right;">
											<p id="date" style="float: left;font-size: 10px;margin-bottom: 0px;">{{result.Timestamp}}</p>
											<i style="float:right;" class="fa fa-times" ng-click="removeFromWishlist($index)"></i>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6" >
											<p id="change" style="float: right;font-size: 10px;">{{result.Change | number:2}}</p>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
											<p id="change_prcnt" style="float: left;font-weight: bolder;font-size: 10px;">( {{result.ChangePercent | number:2}}% )</p>
											<i style="float:right;" class="fa fa-refresh" ng-click="refreshQuote(result.Symbol, $index)"></i>
										</div>
									</div><hr>
								</div>
								
								
								<div class="down"  ng-show="result.Change < 0"  style="float:left;width:100%;">
									<div  class="col-xs-1 col-sm-1 col-md-1 col-lg-1" style="float:left">
										<img style="height:25px;" src="/assets/images/down.jpg">
									</div>
									<div data-ng-click="showQuote($index)" class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="float:left;">
										<p id="name" style="width: 100%;float: left;font-size: 10px;margin-bottom: 0px;" data-ng-click="showQuote($index)">{{result.Name}}</p>
										<p id="prize" style="font-weight: bolder;font-size: 10px;">${{result.LastPrice}}</p>
									</div>
									<div class="col-xs-7 col-sm-7 col-md-7 col-lg-7"style="float:right;">
										<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="float:right;">
											<p id="date" style="float: left;font-size: 10px;margin-bottom: 0px;">{{result.Timestamp}}</p>
											<i style="float:right;" class="fa fa-times" ng-click="removeFromWishlist($index)"></i>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6" >
											<p id="change" style="float: right;font-size: 10px;">{{result.Change | number:2}}</p>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
											<p id="change_prcnt" style="float: left;font-weight: bolder;font-size: 10px;">( {{result.ChangePercent | number:2}}% )</p>
											<i style="float:right;" class="fa fa-refresh" ng-click="refreshQuote(result.Symbol, $index)"></i>
										</div>
									</div><hr>
								</div>
							</div>	
							</div>					
            		 </div>
		            		            
	             
				</div> <!-- /widget -->
			</div>
	 	
	 	
		</div>
	</div>

<script type="text/ng-template" id="getQuote">


        <div class="dialogSpan">
            <div class="dialogBox">
                <div class="dialogBox-header" style="background:ghostwhite;height:15%;">
                    <h1 class="page-title">{{quoteResult.Name}}</h1>
					<i style="float:right;" class="fa fa-times" ng-click="closeThisDialog()"></i>
                </div>

                <div class="dialogBox-content">
                    <table style="width:100%;">
						<tr style="width:100%;">
							<td style="width:49%;">
								<div style="padding-bottom:35%;">
									<div  class="col-xs-4 col-sm-4 col-md-4 col-lg-4" style="float:left;height:75px;">
										<img style="height:60px;" ng-show="quoteResult.Change > 0" src="/assets/images/up.jpg">
										<img style="height:60px;" ng-show="quoteResult.Change < 0" src="/assets/images/down.jpg">
									</div>
									<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8" style="float:left;height:75px;">
										<p id="name" >{{quoteResult.Name}}</p>
										<p id="prize" style="font-weight: bolder;font-size:xx-large;">${{quoteResult.LastPrice}}</p>
									</div>
								</div>
								<div>
									<div  class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
									</div>					
									<div class="col-xs-8 col-sm-8 col-md-8 col-lg-8">
										<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5" >
											<p id="change" style="margin-left:-35%;">{{quoteResult.Change | number:2}}</p>
										</div>
										<div class="col-xs-7 col-sm-7 col-md-7 col-lg-7">
											<p id="change_prcnt" style="float: right;">( {{quoteResult.ChangePercent | number:2}}% )</p>
										</div>	
									</div>
								</div>	
							</td>
							<td style="width:2%"><img style="height:43%;" src="/assets/images/vertical_bar.png"></td>
							<td style="width:49%;">
							<div>	
								<div>
									<label id="forDate" style="float:left;">Date:</label>
									<p id="date">{{quoteResult.Timestamp}}</p>
								</div>
								<div>
									<label id="forOpen" style="float:left;">Open:</label>
									<p id="open">{{quoteResult.Open}}</p>
								</div>
								<div>
									<label id="forHigh" style="float:left;">High:</label>
									<p id="high">{{quoteResult.High}}</p>
								</div>
								<div>
									<label id="forLow" style="float:left;">Low:</label>
									<p id="low">{{quoteResult.Low}}</p>
								</div>
								<div>
									<label id="forChangeYTD" style="float:left;">Change YTD:</label>
									<p id="changeYTD">{{quoteResult.ChangeYTD | number:2}}</p>
								</div>
								<div>
									<label id="forChangePercentYTD" style="float:left;">Change Percent YTD:</label>
									<p id="changePercentYTD">{{quoteResult.ChangePercentYTD | number:2}}</p>
								</div>
								<div>
									<label id="forMSDate" style="float:left;">MS Date:</label>
									<p id="msDate">{{quoteResult.MSDate | number:2}}</p>
								</div>
								<div>
									<label id="forMarketCap" style="float:left;">Market Cap:</label>
									<p id="marketCap">{{quoteResult.MarketCap}}</p>
								</div>
								<div>
									<label id="forVolume" style="float:left;">Volume:</label>
									<p id="volume">{{quoteResult.Volume}}</p>
								</div>
							</div>
							</td>	
						</tr>
					</table>
                </div>


                <div class="dialogBox-footer">
                    
                </div>

            </div>
        </div>



</script>	
	
<script>

$(function() {
    var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket
    var chatSocket = new WS("@routes.Application.chat(localUser.name).webSocketURL(request)")

    var sendImage = function(){
    	var file = document.getElementById("image").files[0];

        var reader = new FileReader();
        // Sends the result of the file read as soon as the reader has
        // completed reading the image file.
        
        reader.onloadend = function(){
        	console.log(reader.result);
        	chatSocket.send(JSON.stringify(
                    {text: reader.result,type: "image"}
            ));
        	//document.getElementById("image") = '';
        };
        // Make sure the file exists and is an image
        if(file && file.type.match("image")){
            reader.readAsDataURL(file);
        }
    } 
    
    
    var sendMessage = function() {
    	console.log("sendMessage");
    	if($("#talk").val() != ""){
            chatSocket.send(JSON.stringify(
                {text: $("#talk").val(),type: "message"}
            ))
            $("#talk").val('')
    	}
    }
    
    var receiveEvent = function(event) {
    	console.log("receivevent");
        var data = JSON.parse(event.data)
        console.log(data);
        if(data.kind == "talk"){
         	    var el = $('<div class="img-comment vignette"><img id="userImage"></div><div class="comment-body"><div class="comment-info"><span id="user"></span><span style="float:right;" id="time"></span></div><span id="message"></span></div><hr>');
                        
         	    if(data.type == "message"){
         	    	$("#message", el).text(data.message);
         	    } else {
         	    	$("#message", el).text("Attachement");
         	    }
                
                $("#user", el).text(data.user);
                $("#time", el).text(data.time);
                $("#userImage", el).attr('src','/getUserPic/'+data.userId);
                $('#messages').append(el);
                var objDiv = document.getElementById("messages");
        		objDiv.scrollTop = objDiv.scrollHeight;
        }
     	// Update the members list
     			    	
        $("#members").html(''); 
        $(data.members).each(function() {
            $("#members").append('<img src="/getUserPic/'+this+'" class="user-img">');
        })
 	}
    
    chatSocket.binaryType = 'arraybuffer';
   	chatSocket.onmessage = receiveEvent;

   	var handleReturnKey = function(e) {
        if(e.charCode == 13 || e.keyCode == 13) {
            e.preventDefault()
            sendMessage()
      	} 
    }
    
   	$('#send').click(function(){
   	    sendImage()
   	});
   	
    $("#talk").keypress(handleReturnKey)  
	
})


$(document).ready(function() {
   	console.log( "ready!" );
  	$(".thumbnail").niceScroll();
});





$(function() {

	$("#symbolsearch")
		.focus()
		.autocomplete({
			source: function(request,response) {
				$.ajax({
					beforeSend: function(){ 
						$("span.help-inline").show();
						$("span.label-info").empty().hide();
					},
					url: "http://dev.markitondemand.com/api/v2/Lookup/jsonp",
					dataType: "jsonp",
					data: {
						input: request.term
					},
					success: function(data) {
						response( $.map(data, function(item) {
							return {
								label: item.Name + " (" +item.Exchange+ ")",
								value: item.Symbol,
								item: item
							}
						}));
						$("span.help-inline").hide();
					}
				});
			},
			minLength: 0,
			select: function( event, ui ) {
				console.log(ui.item.item);
				angular.element('#content').scope().addToWishlist(ui.item.item);
				$("span.label-info").html("You selected " + ui.item.label).fadeIn("fast");
			},
			open: function() {
				//$(this).removeClass("ui-corner-all").addClass("ui-corner-top");
			},
			close: function() {
				//$(this).removeClass("ui-corner-top").addClass("ui-corner-all");
			}
		})
	;
});


$(function() {

	$("#symbolsearch1")
		.focus()
		.autocomplete({
			source: function(request,response) {
				$.ajax({
					beforeSend: function(){ 
						$("span.help-inline").show();
						$("span.label-info").empty().hide();
					},
					url: "http://dev.markitondemand.com/api/v2/Lookup/jsonp",
					dataType: "jsonp",
					data: {
						input: request.term
					},
					success: function(data) {
						response( $.map(data, function(item) {
							return {
								label: item.Name + " (" +item.Exchange+ ")",
								value: item.Symbol,
								item: item
							}
						}));
						$("span.help-inline").hide();
					}
				});
			},
			minLength: 0,
			select: function( event, ui ) {
				console.log(ui.item.item);
				angular.element('#content').scope().getQuote(ui.item.item);
				$("span.label-info").html("You selected " + ui.item.label).fadeIn("fast");
			},
			open: function() {
				//$(this).removeClass("ui-corner-all").addClass("ui-corner-top");
			},
			close: function() {
				//$(this).removeClass("ui-corner-top").addClass("ui-corner-all");
			}
		})
	;
});

</script>	